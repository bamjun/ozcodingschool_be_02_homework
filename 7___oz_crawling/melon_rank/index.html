<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë©œë¡  ê¸‰ìƒìŠ¹ ë²„ë¸”ì°¨íŠ¸</title>
    <style>
      body {
        background-color: rgb(255, 255, 238);
      }
      .container {
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <canvas id="myChart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="data.js"></script>
    <script>
      let minR = Math.min(
        ...data.datasets.flatMap((dataset) =>
          dataset.data.map((item) => item.r)
        )
      );
      let maxR = Math.max(
        ...data.datasets.flatMap((dataset) =>
          dataset.data.map((item) => item.r)
        )
      );

      // r ê°’ì„ 1ì—ì„œ 100 ì‚¬ì´ì˜ ë°±ë¶„ìœ¨ë¡œ ìŠ¤ì¼€ì¼ë§
      data.datasets.forEach((dataset) => {
        dataset.data.forEach((item) => {
          item.r = scaleToRange(item.r, minR, maxR, 10, 100);
        });
      });

      function scaleToRange(value, min, max, newMin, newMax) {
        return ((value - min) / (max - min)) * (newMax - newMin) + newMin;
      }

      let maxY = 0;
      data.datasets.forEach((dataset) => {
        dataset.data.forEach((item) => {
          if (item.y > maxY) {
            maxY = item.y;
          }
        });
      });
      maxY += 1; // ìµœëŒ€ yê°’ë³´ë‹¤ 1 ë†’ê²Œ ì„¤ì •

      const config = {
        type: "bubble",
        data: data,
        options: {
          responsive: true,
          plugins: {
            tooltip: {
              callbacks: {
                label: function (context) {
                  // context ê°ì²´ì—ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ ì¶”ì¶œ
                  let label = context.dataset.label || "";
                  return label;
                },
              },
            },

            legend: {
              position: "top",
            },
            title: {
              display: true,
              text: "ë©œë¡  ê¸‰ìƒìŠ¹ ë²„ë¸”ì°¨íŠ¸ ğŸ¦„" + crawltime,
            },
          },
          scales: {
            x: {
              // type: "linear",
              // position: "bottom",
              min: 100, // xì¶•ì˜ ìµœì†Œê°’ ì„¤ì •
              max: 0, // xì¶•ì˜ ìµœëŒ€ê°’ ì„¤ì •
              reverse: true, // xì¶•ì˜ ìˆœì„œë¥¼ ë’¤ì§‘ìŒ
              title: {
                display: true,
                text: "ìˆœìœ„ ( ë²„ë¸”í¬ê¸° : ì¢‹ì•„ìš” )", // xì¶• ì„¤ëª…
              },
            },
            y: {
              min: 0, // xì¶•ì˜ ìµœì†Œê°’ ì„¤ì •
              max: maxY, // xì¶•ì˜ ìµœëŒ€ê°’ ì„¤ì •
              reverse: false, // xì¶•ì˜ ìˆœì„œë¥¼ ë’¤ì§‘ìŒ
              title: {
                display: true,
                text: "ê¸‰ë“±", // yì¶• ì„¤ëª…
              },
            },
          },
        },
      };

      const ctx = document.getElementById("myChart");

      new Chart(ctx, config);
    </script>
  </body>
</html>
